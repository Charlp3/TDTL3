<!DOCTYPE html><html lang="fr"><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Contacts ENEO ‚Äî v12_dark_full_zebra_v3.2 2025-09-11 14:18</title>
<meta name="theme-color" content="#aeb5bd">
<style>
:root{ --bg:#b8bcc3; --card:#d4d7dd; --text:#0b1220; --muted:#4b5563; --border:#8a919a; --accent:#2563eb;
  --zebra1:#dfe2e7; --zebra2:#d4d7dd; --good:#9ae6b4; --bad:#fca5a5; --warn:#fcd34d; }
:root[data-theme="light"]{ --bg:#e5e7eb; --card:#f3f4f6; --text:#0b1220; --muted:#6b7280; --border:#cbd5e1;
  --zebra1:#f3f4f6; --zebra2:#e5e7eb; --good:#bbf7d0; --bad:#fecaca; --warn:#fde68a; }
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial}
.container{max-width:1100px;margin:0 auto;padding:12px} h1{display:flex;gap:8px;align-items:center;margin:0 0 8px;font-size:19px}
.ver{font-size:9px;color:var(--muted);border:1px solid var(--border);border-radius:999px;padding:1px 6px;background:#fff}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:10px;margin:8px 0}
.small{color:var(--muted);font-size:12px} button{background:var(--accent);color:#fff;border:none;border-radius:10px;padding:6px 10px;font-weight:600;cursor:pointer;font-size:14px;line-height:1}
button.secondary{background:#fff;color:var(--text);border:1px solid var(--border)}
input[type="text"],input[type="email"],input[type="tel"],input[type="number"],input[type="date"],input[type="file"]{background:#fff;border:1px solid var(--border);border-radius:8px;padding:5px 8px;font-size:14px}
table{width:100%;border-collapse:separate;border-spacing:0 6px} thead th{font-size:11px;color:var(--muted);border-bottom:1px dashed var(--border);text-transform:uppercase}
tbody tr{background:var(--zebra2);border:1px solid var(--border)} tbody tr:nth-child(odd){background:var(--zebra1)}
tbody td{padding:6px 6px;vertical-align:middle} tbody tr td:first-child{border-top-left-radius:10px;border-bottom-left-radius:10px}
tbody tr td:last-child{border-top-right-radius:10px;border-bottom-right-radius:10px}
tr.state-green{background:var(--good)!important} tr.state-red{background:var(--bad)!important} tr.state-yellow{background:var(--warn)!important}
.amount input{width:6ch;text-align:right} .col-pres{width:52px} .col-amt{width:66px} .pres input[type="checkbox"]{width:20px;height:20px}
.actions{white-space:nowrap} .actions button{font-size:13px;padding:5px 8px}
.toast{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);background:#111827;color:#e5e7eb;padding:8px 12px;border-radius:10px;border:1px solid #374151;display:none}
.debug{font:12px ui-monospace,monospace;background:#111827;color:#f3f4f6;border:1px solid #374151;border-radius:10px;padding:8px;white-space:pre-wrap}
@media print{body{background:#fff!important;color:#000!important}.card{box-shadow:none!important;border:none!important;background:#fff!important}
table,thead,tbody,tr,td,th{page-break-inside:avoid!important}tr{page-break-after:auto}}
</style></head><body>
<div class="container">
  <h1>Contacts ENEO ‚Äî <span class="ver">v12_dark_full_zebra_v3.2 2025-09-11 14:18</span></h1>

  <div class="card">
    <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
      <label for="sessionDate">Date :</label><input id="sessionDate" type="date">
      <button id="exportPDF" class="secondary">üñ®Ô∏è PDF</button>
      <button id="resetRoster" class="secondary">‚ôªÔ∏è R√©initialiser</button>
      <button id="saveRoster" class="secondary">üíæ Sauver</button>
      <button id="copyTable" class="secondary">üìã Copier (Pr√©s/‚Ç¨/Nom/Pr√©nom)</button>
      <button id="toggleTheme" class="secondary">üåó Clair / Sombre</button>
    </div>
  </div>

  <div class="card">
    <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
      <button id="toggleAddForm">‚ûï Ajouter</button>
      <input id="importCsv" type="file" accept=".csv">
      <button id="importCsvReplace" class="secondary">Importer CSV (Remplacer)</button>
      <button id="exportRosterJson" class="secondary">Exporter JSON</button>
      <input id="importJson" type="file" accept=".json">
      <button id="importRosterJson" class="secondary">Importer JSON</button>
    </div>
    <div id="addForm" style="display:none;margin-top:8px;gap:8px">
      <input id="addNom" placeholder="Nom"><input id="addPrenom" placeholder="Pr√©nom">
      <input id="addGsm" placeholder="GSM (047...)"><input id="addMail" placeholder="Mail">
      <button id="addMember">‚úÖ Ajouter</button>
    </div>
  </div>

  <div class="card">
    <table id="tbl"><thead>
      <tr><th class="col-pres">Pr√©s.</th><th class="col-amt">‚Ç¨</th><th>Nom</th><th>Pr√©nom</th><th>GSM</th><th>Mail</th><th>Actions</th></tr>
    </thead><tbody id="tbody"></tbody></table>
    <div class="small" style="margin-top:6px;display:flex;flex-wrap:wrap;gap:14px">
      <div>Pr√©sents: <span id="countPresence">0</span></div>
      <div>Pr√©sents gratuits: <span id="countFree">0</span></div>
      <div>Pr√©sents 0‚Ç¨: <span id="countZero">0</span></div>
      <div>Pr√©sents payants: <span id="countPaid">0</span></div>
      <div>Total ‚Ç¨ pay√©s: <span id="sumPaid">0,0</span></div>
      <div>Inscrits: <span id="inscritsCounter">0</span></div>
    </div>
  </div>

  <div class="card" id="diagCard">
    <div id="diag" class="debug">Initialisation‚Ä¶</div>
  </div>
</div>
<div class="toast" id="toast">OK</div>

<!-- SAFE JSON payload -->
<script id="seed" type="application/json">[{"nom": "ALLACKER", "prenom": "Paul", "gsm": "477621626", "mail": "paul.allacker@skynet.be"}, {"nom": "BOSSCHAERT", "prenom": "Fran√ßoise", "gsm": "474717828", "mail": "francoise.bosschaert@gmail.com"}, {"nom": "CHARLIER", "prenom": "Pierre", "gsm": "475677680", "mail": "charlier.pierre@skynet.be"}, {"nom": "CHIMKOVITCH", "prenom": "Sophie", "gsm": "474979997", "mail": "sophie.chimkovitch@gmail.om"}, {"nom": "DALLEUR", "prenom": "Jean-Paul", "gsm": "474877837", "mail": "dalleurj@gmail.com"}, {"nom": "DECONINCK", "prenom": "Jean-Pierre", "gsm": "476728383", "mail": "sra@lesanemones.be"}, {"nom": "DEGUENT", "prenom": "Marianne", "gsm": "474811346", "mail": "mdeguent7@gmail.com"}, {"nom": "DENIS", "prenom": "Pierrette", "gsm": "472720227", "mail": "Pierrette_denis@outlook.be"}, {"nom": "DEPIREUX", "prenom": "Dominique", "gsm": "479949630", "mail": "gekerado@gmail.com"}, {"nom": "DIEU", "prenom": "Bernard", "gsm": "476294840", "mail": "planetedit0@gmail.com"}, {"nom": "DOLVELDE", "prenom": "Dick", "gsm": "478780555", "mail": "dick.dolvelde@gmail.com"}, {"nom": "DONNAY", "prenom": "Jacques", "gsm": "476634435", "mail": "jack.donnay30@gmai.com"}, {"nom": "DUBOIS", "prenom": "Claude", "gsm": "477712083", "mail": "dubois.claude@hotmail.com"}, {"nom": "GILLET", "prenom": "Christiane", "gsm": "474693200", "mail": "christiane.gillet@hotmail.com"}, {"nom": "HEYTERS", "prenom": "Eric", "gsm": "475826923", "mail": "eric.heyters@gmail.com"}, {"nom": "LEGLISE", "prenom": "Stephan", "gsm": "476340062", "mail": "unpierreux@yahoo.fr"}, {"nom": "LEVEAU", "prenom": "Jos√©", "gsm": "479321442", "mail": "jcleveau@yahoo.fr"}, {"nom": "LEVELING", "prenom": "Josette", "gsm": "475386560", "mail": "josette.paulus@gmail.com"}, {"nom": "MAGERUS", "prenom": "Michel", "gsm": "476892128", "mail": "michelmagerus@gmail.com"}, {"nom": "MALDAGUE", "prenom": "Olivier", "gsm": "478371701", "mail": "olivier.maldague@gmail.com"}, {"nom": "PAPENS", "prenom": "Dominique", "gsm": "475993125", "mail": "dompapens@yahoo.fr"}, {"nom": "PAULUS", "prenom": "Christian", "gsm": "475284580", "mail": "chpaulus@gmail.com"}, {"nom": "PERROTIN", "prenom": "Herv√©", "gsm": "472212131", "mail": "hymperrotin@gmail.com"}, {"nom": "PUTMANS", "prenom": "Yves", "gsm": "478669111", "mail": "yves.putmans@yahoo.fr"}, {"nom": "RION", "prenom": "Marc-Antoine", "gsm": "475388934", "mail": "marcantoinerion1965@gmail.com"}, {"nom": "SCHILDERMANS", "prenom": "Alain", "gsm": "475606443", "mail": "alain.schildermans@gmail.com"}, {"nom": "VAN PELT", "prenom": "V√©ronique", "gsm": "477456193", "mail": "veronique.vanpelt@icloud.com"}, {"nom": "VANCAPPELLEN", "prenom": "Arlette", "gsm": "477359066", "mail": "arlettevancap@hotmail.com"}, {"nom": "VANDEN BRUGGE", "prenom": "Andr√©e", "gsm": "475381914", "mail": "audrey.vdb.bruens@gmail.com"}, {"nom": "VANDENBROUCKE", "prenom": "Jacques", "gsm": "477261193", "mail": "javanwa41@gmail.com"}, {"nom": "VIGNERON", "prenom": "Jean-Marie", "gsm": "474921000", "mail": "jemavig@live.be"}, {"nom": "WERY", "prenom": "Jean-Luc", "gsm": "478293294", "mail": "weryjl@hotmail.fr"}, {"nom": "WINDAL", "prenom": "Beno√Æt", "gsm": "475941124", "mail": "michele.et.benoit.windal@gmail.com"}]</script>

<script>
(function(){ var d=document.getElementById('diag'); if(d) d.textContent += "\nScript charg√© (trace 0)"; })();
</script>

<script>
(function(){
  function getSeed(){
    try{ return JSON.parse(document.getElementById('seed').textContent || "[]"); }
    catch(e){ return []; }
  }

  const CSV_ROSTER = getSeed();
  const rosterKey='contacts-eneo:roster-zebra-v3.2';
  const themeKey='contacts-eneo:theme';
  const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
  const toast=(m)=>{const t=$('#toast');t.textContent=m||'OK';t.style.display='block';setTimeout(()=>t.style.display='none',1200)};
  const diag=(msg)=>{ const d=$('#diag'); d.textContent = (d.textContent? d.textContent+"\n":"")+msg; };
  const showErr=(msg)=>{ diag("ERREUR JS ‚Üí "+msg); };
  window.onerror = function(msg, src, line, col){ showErr(msg + " @ " + line + ":" + col); };

  const applyTheme = (t)=>{ document.documentElement.setAttribute('data-theme', t==='light'?'light':'dark'); try{localStorage.setItem(themeKey,t);}catch(e){} };
  const startTheme = (function(){ try{ return localStorage.getItem(themeKey) || 'dark'; }catch(e){ return 'dark'; } })();
  applyTheme(startTheme);
  document.addEventListener('click', (e)=>{ if(e.target && e.target.id==='toggleTheme'){ const t=(function(){try{return localStorage.getItem(themeKey)||'dark';}catch(e){return 'dark';}})()==='dark'?'light':'dark'; applyTheme(t); }});

  try{
    diag("JS d√©marr√© ‚úÖ");

    const normGSM=(s)=>{ if(!s) return ''; var t=String(s).trim().replace(/[^0-9+]/g,'');
      if(t.indexOf('+324')===0) t='0'+t.slice(3);
      if(t.indexOf('0')!==0) t='0'+t.replace(/^0+/,'');
      if(t.indexOf('04')===0 && t.indexOf('047')!==0) t='047'+t.slice(3);
      t=t.replace(/\D/g,''); if(t.length>10) t=t.slice(0,10); return t;
    };

    function loadRosterRaw(){
      try{ var r=JSON.parse(localStorage.getItem(rosterKey)||'[]'); return r && r.constructor===Array ? r: []; }
      catch(e){ return []; }
    }
    function loadRoster(){
      var r = loadRosterRaw();
      if(!r || r.length===0){
        r = CSV_ROSTER.slice();
        try{ localStorage.setItem(rosterKey, JSON.stringify(r)); }catch(e){}
        diag("Liste restaur√©e √† partir du CSV int√©gr√©");
      }
      return r.map(function(m){ return { nom:(m.nom||''), prenom:(m.prenom||''), gsm:normGSM(m.gsm||''), mail:(m.mail||'') }; });
    }
    function saveRoster(r){ r.forEach(function(m){ m.gsm=normGSM(m.gsm||''); }); try{ localStorage.setItem(rosterKey, JSON.stringify(r)); }catch(e){} updateCounts(); }

    function makeRow(m){
      var tr=document.createElement('tr');
      tr.innerHTML = '<td class="pres"><input type="checkbox"></td><td class="amount"><input type="number" step="0.5" min="0" placeholder="0,0"></td>' +
                     '<td class="name"></td><td class="pre"></td><td class="gsm"></td><td class="mail"></td>' +
                     '<td class="actions"><button class="secondary editRow">‚úèÔ∏è</button> <button class="secondary deleteRow">üóëÔ∏è</button></td>';
      tr.querySelector('.name').textContent = (m.nom||'').trim();
      tr.querySelector('.pre').textContent  = (m.prenom||'').trim();
      tr.querySelector('.gsm').textContent  = normGSM((m.gsm||'').trim());
      tr.querySelector('.mail').textContent = (m.mail||'').trim();
      return tr;
    }
    function rebuild(){
      var tb=$('#tbody'); tb.innerHTML=''; var r=loadRoster(); r.forEach(function(m){ tb.appendChild(makeRow(m)); });
      $('#inscritsCounter').textContent = r.length; diag('JS OK ‚Äî lignes: '+r.length); updateCounts();
    }

    function applyRowStates(){
      $$('#tbl tbody tr').forEach(function(tr){
        tr.classList.remove('state-green','state-red','state-yellow');
        var present = tr.querySelector('.pres input').checked;
        var txt     = (tr.querySelector('.amount input').value||'').trim();
        var amt     = txt===''? null : (parseFloat(txt.replace(',','.'))||0);
        if(present){
          if(amt===null) tr.classList.add('state-yellow');
          else if(amt>0) tr.classList.add('state-green');
          else tr.classList.add('state-red');
        }
      });
    }
    function updateCounts(){
      var present=0, free=0, zero=0, paidCount=0, paidSum=0;
      $$('#tbl tbody tr').forEach(function(tr){
        var cb  = tr.querySelector('.pres input');
        var txt = (tr.querySelector('.amount input').value||'').trim();
        var amt = txt===''? null : (parseFloat(txt.replace(',','.'))||0);
        if(cb.checked){
          present++;
          if(amt===null) free++;
          else if(amt===0) zero++;
          else if(amt>0){ paidCount++; paidSum+=amt; }
        }
        tr.querySelector('.gsm').textContent = normGSM(tr.querySelector('.gsm').textContent);
      });
      $('#countPresence').textContent = String(present);
      $('#countFree').textContent = String(free);
      $('#countZero').textContent = String(zero);
      $('#countPaid').textContent = String(paidCount);
      $('#sumPaid').textContent = paidSum.toFixed(1).replace('.',',');
      applyRowStates();
    }

    document.addEventListener('input',function(e){
      if(e.target && e.target.matches('.amount input')){
        var tr=e.target.closest('tr');
        tr.querySelector('.pres input').checked = (e.target.value||'').trim()!=='';
      }
      if(e.target && e.target.matches('.pres input,.amount input')) updateCounts();
    });
    document.addEventListener('change',function(e){
      if(e.target && e.target.matches('.pres input')){
        var tr=e.target.closest('tr');
        if(!e.target.checked) tr.querySelector('.amount input').value='';
        updateCounts();
      }
    });
    document.addEventListener('click',function(e){
      if(e.target && e.target.matches('.editRow')){
        var tr=e.target.closest('tr');
        var n=tr.querySelector('.name').textContent.trim(),
            p=tr.querySelector('.pre').textContent.trim(),
            g=tr.querySelector('.gsm').textContent.trim(),
            m=tr.querySelector('.mail').textContent.trim();
        tr.dataset.orig=[n,p,g,m].join('|');
        tr.querySelector('.name').innerHTML = '<input class="e-name" value="'+n.replace(/"/g,'&quot;')+'">';
        tr.querySelector('.pre').innerHTML  = '<input class="e-pre" value="'+p.replace(/"/g,'&quot;')+'">';
        tr.querySelector('.gsm').innerHTML  = '<input class="e-gsm" value="'+g.replace(/"/g,'&quot;')+'">';
        tr.querySelector('.mail').innerHTML = '<input class="e-mail" value="'+m.replace(/"/g,'&quot;')+'">';
        e.target.textContent='üíæ'; e.target.classList.add('saveRow'); e.target.classList.remove('editRow');
      } else if(e.target && e.target.matches('.saveRow')){
        var tr=e.target.closest('tr');
        var n=tr.querySelector('.e-name').value.trim(),
            p=tr.querySelector('.e-pre').value.trim(),
            g=normGSM(tr.querySelector('.e-gsm').value.trim()),
            m=tr.querySelector('.e-mail').value.trim();
        var r=loadRoster();
        var parts=(tr.dataset.orig||'|||').split('|');
        var idx=r.findIndex(function(x){ return (x.nom||'')===parts[0] && (x.prenom||'')===parts[1] && (x.gsm||'')===parts[2] && (x.mail||'')===parts[3]; });
        if(idx>=0) r[idx]={nom:n,prenom:p,gsm:g,mail:m}; else r.push({nom:n,prenom:p,gsm:g,mail:m});
        saveRoster(r); rebuild(); toast('Membre modifi√© ‚úÖ');
      } else if(e.target && e.target.matches('.deleteRow')){
        var tr=e.target.closest('tr');
        var parts=[tr.querySelector('.name').textContent.trim(),tr.querySelector('.pre').textContent.trim(),normGSM(tr.querySelector('.gsm').textContent.trim()),tr.querySelector('.mail').textContent.trim()];
        var r=loadRoster().filter(function(x){ return !(((x.nom||'')===parts[0])&&((x.prenom||'')===parts[1])&&((x.gsm||'')===parts[2])&&((x.mail||'')===parts[3])); });
        saveRoster(r); rebuild(); toast('Membre supprim√© üóëÔ∏è');
      }
    });

    document.getElementById('toggleAddForm').addEventListener('click',function(){
      var f=document.getElementById('addForm'); f.style.display=(f.style.display==='none'?'flex':'none'); if(f.style.display==='') f.style.display='flex';
    });
    document.getElementById('addMember').addEventListener('click',function(){
      var n=document.getElementById('addNom').value.trim(), p=document.getElementById('addPrenom').value.trim(), g=normGSM(document.getElementById('addGsm').value.trim()), m=document.getElementById('addMail').value.trim();
      if(!n && !p && !g && !m){ toast('Renseigne au moins Nom ou GSM'); return; }
      var r=loadRoster(); r.push({nom:n,prenom:p,gsm:g,mail:m}); saveRoster(r); rebuild();
      document.getElementById('addNom').value=document.getElementById('addPrenom').value=document.getElementById('addGsm').value=document.getElementById('addMail').value='';
      toast('Membre ajout√© ‚úÖ');
    });

    document.getElementById('copyTable').addEventListener('click', function(){
      var rows=[['Pr√©sence','‚Ç¨','Nom','Pr√©nom'].join('\t')];
      Array.prototype.slice.call(document.querySelectorAll('#tbl tbody tr')).forEach(function(tr){
        var pres = tr.querySelector('.pres input').checked ? 1 : 0;
        var eur  = (tr.querySelector('.amount input').value || '').trim();
        var nom  = tr.querySelector('.name').textContent.trim();
        var pre  = tr.querySelector('.pre').textContent.trim();
        rows.push([pres, eur, nom, pre].join('\t'));
      });
      var tsv=rows.join('\n');
      (navigator.clipboard && navigator.clipboard.writeText? navigator.clipboard.writeText(tsv) : Promise.reject())
        .then(function(){toast('Copi√© ‚úÖ')}).catch(function(){ var ta=document.createElement('textarea'); ta.value=tsv; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); toast('Copi√© ‚úÖ'); });
    });

    document.getElementById('resetRoster').addEventListener('click',function(){ try{localStorage.removeItem(rosterKey);}catch(e){} rebuild(); toast('Liste r√©initialis√©e ‚ôªÔ∏è'); });
    document.getElementById('saveRoster').addEventListener('click',function(){ saveRoster(loadRoster()); toast('Liste sauvegard√©e üíæ'); });
    document.getElementById('exportRosterJson').addEventListener('click',function(){ var data=JSON.stringify(loadRoster(),null,2); var a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([data],{type:'application/json'})); a.download='roster_'+(new Date()).toISOString().slice(0,10)+'.json'; a.click(); });
    document.getElementById('importRosterJson').addEventListener('click',async function(){ var f=document.getElementById('importJson').files[0]; if(!f){ toast('Choisis un JSON'); return; } try{ var arr=JSON.parse(await f.text()); if(!Array.isArray(arr)) throw 0; saveRoster(arr); rebuild(); toast('Liste import√©e ‚úÖ'); } catch(e){ toast('JSON invalide'); } });
    document.getElementById('importCsvReplace').addEventListener('click',async function(){ var f=document.getElementById('importCsv').files[0]; if(!f){ toast('Choisis un CSV'); return; } var txt=await f.text(); var lines=txt.trim().split(/\r?\n/); var sep=lines[0].indexOf(';')>=0?';':',';
      var cols=lines[0].split(sep).map(function(s){return s.trim().toLowerCase();}); var idx=function(n){return cols.findIndex(function(c){return new RegExp(n).test(c);});};
      var iNom=idx('^nom$'), iPre=idx('^pr|^pre'), iGsm=idx('gsm|t|mobile'), iMail=idx('mail|email'); var r=[];
      for(var i=1;i<lines.length;i++){ var c=lines[i].split(sep); r.push({nom:(c[iNom]||'').trim(),prenom:(c[iPre]||'').trim(),gsm:normGSM(c[iGsm]||''),mail:(c[iMail]||'').trim()}); }
      saveRoster(r); rebuild(); toast('Liste remplac√©e ‚úÖ');
    });
    document.getElementById('exportPDF').addEventListener('click',function(){ window.print(); });

    document.getElementById('sessionDate').value = (new Date()).toISOString().slice(0,10);
    diag("Chargement des donn√©es‚Ä¶");
    rebuild();
  }catch(e){
    showErr(e && e.message ? e.message : String(e));
  }
})();
</script>
</body></html>
