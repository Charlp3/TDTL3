<!doctype html>
<html lang="fr" data-theme="auto">
<head>
  <meta charset="utf-8" />
  <title>TDTL v2.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <meta name="theme-color" content="#0a84ff" id="themeColorMeta" />
  <style>
    :root{
      --upper:#f2f2f7; --page:#e5e5ea; --panel:#ffffff;
      --ink:#111; --sub:#555; --border:#d1d1d6; --accent:#007aff;
      --ok:#28cd41; --warn:#ffcc00; --bad:#ff3b30;
      --head-dark:#3a3a3c;
      --fab-h:60px;
      --sheet-bg:#ffffff; --sheet-text:#111;
      --table-head-text:#f2f2f7;
      --hover-outline: rgba(0,122,255,.25);
      --toast-bg:#111; --toast-fg:#fff;
    }
    :root[data-theme="dark"]{
      --upper:#1c1c1e; --page:#111113; --panel:#1a1a1d;
      --ink:#e6e6eb; --sub:#a1a1a7; --border:#2c2c2e; --accent:#0a84ff;
      --ok:#30d158; --warn:#ffd60a; --bad:#ff453a;
      --head-dark:#1f1f22;
      --sheet-bg:#161618; --sheet-text:#eaeaf0; --table-head-text:#d8d8df;
      --hover-outline: rgba(10,132,255,.35);
      --toast-bg:#0b0b0d; --toast-fg:#fff;
    }

    body{margin:0;color:var(--ink);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,Helvetica,Arial,sans-serif;background:linear-gradient(180deg,var(--upper)0%,var(--page)420px,var(--page)100%)}

    /* ===== Header compact ===== */
    header{position:sticky;top:0;z-index:40;padding:4px 12px;background:var(--upper);border-bottom:1px solid var(--border)}
    h1{margin:0;font-size:1rem;font-weight:700}

    .wrap{max-width:1100px;margin:0 auto;padding:12px 12px calc(var(--fab-h)+16px)}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:12px;overflow:hidden}

    /* ===== Toolbar ===== */
    .toolbar{display:flex;gap:6px;padding:6px;align-items:center;flex-wrap:wrap;background:var(--upper);border-bottom:1px solid var(--border)}
    .search{flex:1 1 200px;height:32px;padding:4px 8px;border:1px solid var(--border);border-radius:6px;background:#fff}
    .btn{height:32px;padding:0 8px;border-radius:6px;border:1px solid var(--border);background:#fff;font-size:.8rem;font-weight:600;cursor:pointer}
    .btn.primary{background:linear-gradient(180deg,#0a84ff,#007aff);color:#fff;border:none}
    .btn.danger{background:#fff0f0;color:#b10000;border-color:#ffd1d1}
    .seg{display:inline-flex;border:1px solid var(--border);border-radius:6px;overflow:hidden;background:#fff}
    .seg button{height:28px;padding:0 8px;border:0;background:transparent;font-size:.8rem}
    .seg button.active{background:var(--accent);color:#fff}

    /* ===== Stats ===== */
    .displayBar{display:flex;gap:10px;align-items:center;padding:4px 6px;background:var(--upper);border-top:1px solid var(--border);border-bottom:1px solid var(--border);font-size:.8rem}
    .pill{background:#fff;border:1px solid var(--border);padding:2px 6px;border-radius:999px}

    /* ===== Formulaire ===== */
    form.add{display:grid;grid-template-columns:repeat(6,1fr) auto;gap:6px;padding:6px;background:var(--upper);border-bottom:1px solid var(--border)}
    label{font-size:.7rem;color:var(--sub);margin:0 0 2px}
    input,select{width:100%;height:28px;padding:2px 4px;border-radius:4px;border:1px solid var(--border);background:#fff;font-size:.8rem}

    /* ===== Table ===== */
    .tblWrap{max-height:60svh;overflow:auto}
    table{width:100%;border-collapse:separate;border-spacing:0;min-width:600px}
    thead th{position:sticky;top:0;z-index:30;padding:4px;text-align:left;font-size:.7rem;color:var(--table-head-text);background:var(--head-dark)}
    tbody td{padding:6px;border-bottom:1px solid var(--border);font-size:.8rem}
    tbody tr:nth-child(odd){background:#f9f9fb}
    tbody tr:nth-child(even){background:#ececef}
    :root[data-theme="dark"] tbody tr:nth-child(odd){background:#2c2c2e}
    :root[data-theme="dark"] tbody tr:nth-child(even){background:#3a3a3c}

    .nameBadge{padding:2px 6px;border-radius:4px;font-weight:700}
    .nameBadge.green{background:#28cd41;color:#fff}
    .nameBadge.red{background:#ff3b30;color:#fff}
    .nameBadge.yellow{background:#ffcc00;color:#111}

    /* ===== Footer ===== */
    .fabBar{position:fixed;left:0;right:0;bottom:0;z-index:50;background:rgba(250,250,252,.96);backdrop-filter:blur(8px);border-top:1px solid var(--border);padding:6px;display:flex;gap:6px}
    .fabBar .btn{flex:1}

    /* ===== Sheet ===== */
    .sheet{position:fixed;left:0;right:0;bottom:0;z-index:60;background:var(--sheet-bg);color:var(--sheet-text);border-radius:12px 12px 0 0;box-shadow:0 -4px 12px rgba(0,0,0,.2);transform:translateY(100%);transition:.25s;padding:12px;max-height:70svh;overflow:auto}
    .sheet.show{transform:translateY(0)}
    .sheet .row{display:grid;grid-template-columns:100px 1fr;gap:8px;margin-bottom:8px}
    .sheet .actions{display:flex;gap:6px;justify-content:flex-end}

    .toast{position:fixed;bottom:80px;right:16px;background:var(--toast-bg);color:var(--toast-fg);padding:8px 12px;border-radius:8px;opacity:0;transition:.25s}
    .toast.show{opacity:1}
  </style>
</head>
<body>
<header>
  <h1>TDTL v2.0</h1>
</header>
<div class="wrap">
  <div class="card">
    <div class="toolbar">
      <input id="search" class="search" placeholder="Recherche..." />
      <div class="seg">
        <button id="themeAuto" class="active">Auto</button>
        <button id="themeLight">Clair</button>
        <button id="themeDark">Sombre</button>
      </div>
      <button class="btn" id="btnImport">Importer</button>
      <button class="btn" id="btnOptions">Options</button>
    </div>
    <div class="displayBar">
      <span class="pill">Présents: <strong id="statPresents">0</strong></span>
      <span class="pill">Total: <strong id="statTotal">0,00 €</strong></span>
    </div>
    <form class="add" id="addForm">
      <div><label>Prénom</label><input id="prenom" required></div>
      <div><label>Nom</label><input id="nom" required></div>
      <div><label>Tel</label><input id="tel"></div>
      <div><label>Mail</label><input id="mail"></div>
      <div><label>Montant</label><input id="montant" type="number"></div>
      <div><label>Présent</label><select id="present"><option value="false">Non</option><option value="true">Oui</option></select></div>
      <button class="btn primary" type="submit">+</button>
    </form>
    <div class="tblWrap">
      <table>
        <thead><tr><th></th><th>Nom & Prénom</th><th>Présent</th><th>Montant</th><th>Actions</th></tr></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>
</div>
<div class="fabBar">
  <button class="btn danger" id="deleteSelected">Supprimer</button>
  <button class="btn" id="exportBtn">Exporter</button>
  <button class="btn primary" id="saveBtn">Sauver</button>
</div>
<div id="sheetRow" class="sheet">
  <h3>Éditer</h3>
  <div class="row"><label>Nom</label><input id="rowNom"></div>
  <div class="row"><label>Prénom</label><input id="rowPrenom"></div>
  <div class="row"><label>Tel</label><input id="rowTel"></div>
  <div class="row"><label>Mail</label><input id="rowMail"></div>
  <div class="actions">
    <button class="btn danger" id="rowDelete">Supprimer</button>
    <button class="btn" id="rowCancel">Annuler</button>
    <button class="btn primary" id="rowSave">Enregistrer</button>
  </div>
</div>
<div id="toast" class="toast">✔️</div>
<script>
const $=s=>document.querySelector(s);
const STORAGE_KEY="tdtl_v2";
let state=JSON.parse(localStorage.getItem(STORAGE_KEY)||'{"players":[]}');
function save(){localStorage.setItem(STORAGE_KEY,JSON.stringify(state))}
function toast(msg){const t=$("#toast");t.textContent=msg;t.classList.add("show");setTimeout(()=>t.classList.remove("show"),1500)}
function badgeClass(p){if(!p.present)return"";if(p.montant==null)return"yellow";if(p.montant==0)return"red";if(p.montant>0)return"green";return""}
function render(){
  const tb=$("#tbody");tb.innerHTML="";
  let total=0,pres=0;
  for(const pl of state.players){
    const tr=document.createElement("tr");
    tr.innerHTML=`<td><input type="checkbox" data-id="${pl.id}"></td>
      <td><span class="nameBadge ${badgeClass(pl)}"></span> ${pl.nom.toUpperCase()} ${pl.prenom}</td>
      <td><input type="checkbox" data-pres="${pl.id}" ${pl.present?"checked":""}></td>
      <td><input type="number" data-montant="${pl.id}" value="${pl.montant??""}" style="width:70px"></td>
      <td><button class="btn" data-edit="${pl.id}">✎</button></td>`;
    tb.appendChild(tr);
    if(pl.present){pres++;total+=pl.montant||0}
  }
  $("#statPresents").textContent=pres;
  $("#statTotal").textContent=total.toFixed(2)+" €";
}
function addPlayer(prenom,nom,tel,mail,present,montant){
  state.players.push({id:crypto.randomUUID(),prenom,nom,tel,mail,present,montant:montant?+montant:null});
  save();render();
}
$("#addForm").onsubmit=e=>{
  e.preventDefault();
  addPlayer($("#prenom").value,$("#nom").value,$("#tel").value,$("#mail").value,$("#present").value==="true",$("#montant").value);
  e.target.reset();
}
$("#tbody").onchange=e=>{
  const id=e.target.dataset.pres||e.target.dataset.montant;
  const pl=state.players.find(p=>p.id===id);
  if(!pl)return;
  if(e.target.dataset.pres!==undefined)pl.present=e.target.checked;
  if(e.target.dataset.montant!==undefined)pl.montant=e.target.value?+e.target.value:null;
  save();render();
};
$("#tbody").onclick=e=>{
  const id=e.target.dataset.edit;
  if(!id)return;
  const pl=state.players.find(p=>p.id===id);
  $("#rowNom").value=pl.nom;$("#rowPrenom").value=pl.prenom;$("#rowTel").value=pl.tel;$("#rowMail").value=pl.mail;
  $("#sheetRow").classList.add("show");
  $("#rowSave").onclick=()=>{pl.nom=$("#rowNom").value;pl.prenom=$("#rowPrenom").value;pl.tel=$("#rowTel").value;pl.mail=$("#rowMail").value;save();render();$("#sheetRow").classList.remove("show")};
  $("#rowCancel").onclick=()=>$("#sheetRow").classList.remove("show");
  $("#rowDelete").onclick=()=>{state.players=state.players.filter(p=>p.id!==id);save();render();$("#sheetRow").classList.remove("show")};
};
$("#deleteSelected").onclick=()=>{
  const ids=[...document.querySelectorAll("#tbody input[type=checkbox]:checked")].map(c=>c.dataset.id).filter(Boolean);
  state.players=state.players.filter(p=>!ids.includes(p.id));save();render();
};
$("#exportBtn").onclick=()=>{
  let csv="Nom;Prénom;Montant\n";
  state.players.forEach(p=>csv+=`${p.nom};${p.prenom};${p.montant??""}\n`);
  const blob=new Blob([csv],{type:"text/csv"});const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="export.csv";a.click();
};
$("#saveBtn").onclick=()=>{save();toast("Sauvegardé ✔️")};
render();
</script>
</body>
</html>
